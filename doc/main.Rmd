---
title: "GR5320 Project"
output: html_notebook
---


Step 1: Load Data

```{r}
XOM <- read.csv("../data/XOM-bloomberg.csv")
INTC <- read.csv("../data/INTC-bloomberg.csv")

XOM$Dates <- as.Date(XOM$Dates,"%m/%d/%Y")
INTC$Dates <- as.Date(INTC$Dates,"%m/%d/%Y")
```

Step 2: Source function and fiels 
```{r}
library(ggplot2)
# calculate parameter for return
source("../code/parameter/winEstGBM.R")
source("../code/parameter/expEstGBM.R")

# historical VaR/ES
source("../code/stock/HVaR.R")
source("../code/stock/HES.R")

# monte carlo VaR/ES
source("../code/stock/MCVAR & MCES.R")
source("../code/stock/MC_update.R")
source("../code/MC_complicate.R") #inlcuding complicate inputs (bmsampset,tv)

source("../code/Put_MCVaR.R")

# Parametric VaR/ES
source("../code/stock/gbmVaR.R")
source("../code/stock/gbmES.R")
source("../code/parametricVaR.R")

source("../doc/calculation_measure.R")
```


```{r}
# create plot function for VaR
plotGraph <- function(index,Dates){
  # set up the length of two variable
  if (class(index)=="data.frame"){
    minlen <- min(nrow(index),length(Dates))
    index <- index[1:minlen,]
  }else{
    minlen <- min(length(index),length(Dates))
    length(index) <- minlen
  }
  Dates <- Dates[1:minlen]
  
  # create a dataframe
  df <- cbind.data.frame(Dates,index)
  
  # plot
  ggplot()+
  geom_line(aes(x=df$Dates,y=df$index,color="VaR"))
}
```


```{r}
price1 <- XOM$PX_LAST
price2 <- INTC$PX_LAST
dRtn <- 1
year <- 5
par1 <- winEstGBM(price1,dRtn,year)
par2 <- winEstGBM(price2,dRtn,year)

#### Individual Stocks ####
# historical VaR  
Hvar <- HVaR_S(price1,0.99,dRtn,year)
plotGraph(Hvar,INTC$Dates)

plot(Hvar$Hvar)
hist(-diff(log(price1)))

# paramentric VaR
Gvar <- gbmVaR(10000,par1$mu_gbm,par1$sigma_gbm,0.99,1)
plotGraph(Gvar,INTC$Dates)


# Monte Carlo VaR
MVaR <- MCVaR(s0, par1$mu_gbm, par1$sigma_gbm, p, dt, npaths,years,dRtn)
plotGraph(MVaR,INTC$Dates)


#### Portfolio ####
# Parametric VaR (portfolio follow Normal Distribution)
s1 <- XOM$PX_LAST
s2 <- INTC$PX_LAST
s1_0 <- 32.0625 #XOM
s2_0 <- 25.0156 #INTC
mu1 <- par1$mu_gbm[1:7000]
mu2 <- par2$mu_gbm[1:7000]
sigma1 <- par1$sigma_gbm[1:7000]
sigma2 <- par2$sigma_gbm[1:7000]
a <- c(156,200)  # if we only assign weights to each component of portfolio? how to decide position here?
s0 <- c(s1_0,s2_0)  # what's s1_0 and s2_0 here, is the dailty stock price?
v0 = FALSE
mu <- c(mu1,mu2)
sigma <- c(sigma1,sigma2)
datadt <- 1/252
rtn1 <- -diff(log(s1),1)
rtn2 <- -diff(log(s2),1)
rtn1 <- rtn1[1:7000]
rtn2 <- rtn2[1:7000]
rho <- cov(rtn1,rtn2)/datadt/(sigma1*sigma2)
t <- 5/252
p <- 0.99

PVaR <- parametricVaR(a,s0,mu,sigma,rho,p,t)
plotGraph(Gvar,INTC$Dates)


# put optoin
# opvar <- Put_MCVaR(10000,par1$mu_gbm,par1$sigma_gbm,0.01,17.67/100,2085.18,1,100,90,0.99,5,10)  # n?
```


#################################### Don't Run Below Parts #################
Step 3: portfolio Analysis
```{r}
# component set in the portfolio
ticker <- c("XOM","INTC")
s_weight <- c("0.5","0.3")
op_weight <- 1-sum(as.numeric(s_weight))

#Construct Portfolio
stock <- ticker*s_weight
port <- stock+option*op_weight

#MC VaR

```



#########################################################
Step:test part
```{r}
# package to load stock price
if (!require("quantmod")) {
    install.packages("quantmod")
    library(quantmod)
}
# Get me my beloved pipe operator!
if (!require("magrittr")) {
    install.packages("magrittr")
    library(magrittr)
}
```

```{r}
# one approach to load stock dataset
start <- as.Date("2010-01-01")
end <- as.Date("2018-10-01")

getSymbols("AAPL", src = "yahoo", from = start, to = end)
getSymbols(c("MSFT", "GOOG"), src = "yahoo", from = start, to = end)

aple <- Ad(getSymbols("AAPL", src = "yahoo", auto.assign= F, from = start))
intc <- Ad(getSymbols("INTC", src = "yahoo", auto.assign= F, from = start))

stocks <- as.xts(data.frame(AAPL = AAPL[, "AAPL.Close"], MSFT = MSFT[, "MSFT.Close"], 
    GOOG = GOOG[, "GOOG.Close"]))

# useful in plot
chartSeries(returns_AAPL)

```


