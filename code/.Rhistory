hw10 <- read.csv("C:/Users/Xiaojie Wei/Desktop/Fall 2018/GR5320 Financial Risk Management/HW/HW10/hw10.csv")
View(hw10)
getwd()
source("../HW/code/winEstGBM.RData")
source("../HW/code/winEstGBM.R")
source("../winEstGBM.R")
source("C:/Users/Xiaojie Wei/Desktop/Fall 2018/GR5320 Financial Risk Management/HW/code/winEstGBM.R")
source("C:/Users/Xiaojie Wei/Desktop/Fall 2018/GR5320 Financial Risk Management/HW/code/gbmVaR.R")
par <- winEstGBM(hw10$PX_LAST,5*252)
VaR <- gbmVaR(v0,par$mu_gbm,par$sigma_gbm,0.99,5*252)
v0 <- 10000000
VaR <- gbmVaR(v0,par$mu_gbm,par$sigma_gbm,0.99,5*252)
dist(VaR)
hist(VaR)
View(par)
View(hw10)
hm10$x <- c(1:2983)
hw10$x <- c(1:2983)
View(hw10)
dat <- sort(hw10$x,decreasing=T)
rev(hw10)
View(hw10)
View(hw10)
rev(hw10)
m <- rev(hw10)
View(m)
View(hw10)
dat <- sort(hw10,decreasing=T)
dat <- sort(hw10$x,decreasing=T)
dat <- order(hw10$x,decreasing=T)
dat <- order(hw10,decreasing=T)
dat <- hw10[order(hw10$x,decreasing=T)]
dat <- hw10[order(hw10$x,decreasing=T),]
View(dat)
par <- winEstGBM(dat$PX_LAST,5*252)
v0 <- 10000000
VaR <- gbmVaR(v0,par$mu_gbm,par$sigma_gbm,0.99,5*252)
hist(VaR)
head(VaR)
head(-VaR)
View(par)
VaR <- gbmVaR(v0,par$mu_gbm,par$sigma_gbm,0.99,5*252)
hist(VaR)
head(VaR)
VaR <- gbmVaR(v0,par$mu_gbm,par$sigma_gbm,0.99,5/252)
head(VaR)
head(VaR)
head(par)
var <- 411568.8
mu <- 0.1133424
sigma <- 0.1345705
K <- 2085.18
T <- 1
t <- 0
d1 <- 1/(sigma*(sqrt(T-t)))*(log(1)+(r+sigma^2/2)*(T-t))
T <- 1
t <- 0
r <- 0.5%
T <- 1
t <- 0
r <- 0.005
d1 <- 1/(sigma*(sqrt(T-t)))*(log(1)+(r+sigma^2/2)*(T-t))
d2 <- d1-sigma*sqrt(T-t)
put <- pnorm(-d2)*K*exp(-r*(T-t))-K*pnorm(-d1)
vol <- 17.67
d1 <- 1/(vol*(sqrt(T-t)))*(log(1)+(r+vol^2/2)*(T-t))
d2 <- d1-vol*sqrt(T-t)
put <- pnorm(-d2)*K*exp(-r*(T-t))-K*pnorm(-d1)
K <- 2085.18
S <- 2085.18
T <- 1
r <- 0.005
vol <- 17.67
Put <- function(S, K, r, T, vol) {
d1  <-  (log(S/K) + (r + vol^2/2)*T) / (vol*sqrt(T))
d2  <-  d1 - vol*sqrt(T)
put <- -S * pnorm(-d1) + K*exp(-r*T)*pnorm(-d2)
return(Put)
}
out <- Put(S,K,r,T,vol)
port <- 2085.18*(0.99*10000000/2085.18)-10000000*0.01/put
put <- Put(S,K,r,T,vol)
Put <- function(S, K, r, T, vol) {
d1  <-  (log(S/K) + (r + vol^2/2)*T) / (vol*sqrt(T))
d2  <-  d1 - vol*sqrt(T)
put <- -S * pnorm(-d1) + K*exp(-r*T)*pnorm(-d2)
return(put)
}
put <- Put(S,K,r,T,vol)
Put <- function(S, K, r, T, vol) {
d1  <-  (log(S/K) + (r + vol^2/2)*T) / (vol*sqrt(T))
d2  <-  d1 - vol*sqrt(T)
-S * pnorm(-d1) + K*exp(-r*T)*pnorm(-d2)
}
K <- 2085.18
S <- 2085.18
T <- 1
r <- 0.005
vol <- 17.67
put <- Put(S,K,r,T,vol)
vol <- 17.67/100
put <- Put(S,K,r,T,vol)
port <- 2085.18*(0.99*10000000/2085.18)-10000000*0.01/put
loss <- port-10000000
port <- 2085.18*(0.99*10000000/2085.18)-10000000*0.01/put
loss <- port-10000000
hw10 <- read.csv("C:/Users/Xiaojie Wei/Desktop/Fall 2018/GR5320 Financial Risk Management/HW/HW10/hw10.csv")
source("C:/Users/Xiaojie Wei/Desktop/Fall 2018/GR5320 Financial Risk Management/HW/code/winEstGBM.R")
source("C:/Users/Xiaojie Wei/Desktop/Fall 2018/GR5320 Financial Risk Management/HW/code/gbmVaR.R")
hw10$x <- c(1:2983)
dat <- hw10[order(hw10$x,decreasing=T),]
p1 <- Put(dat$PX_LAST,dat$PX_LAST,r,T,dat$X12MO_PUT_IMP_VOL)
pot1 <- dat$PX_LAST*(0.99*10000000/dat$PX_LAST)-10000000*0.01/p1
loss1 <- pot1-p1
hvar <- quantile(loss1,0.01)
loss1 <- 10000000-pot1
hvar <- quantile(loss1,0.01)
View(loss1)
par[2]
par <- winEstGBM(dat$PX_LAST,5*252)
v0 <- 10000000
VaR <- gbmVaR(v0,par$mu_gbm,par$sigma_gbm,0.99,5/252)
par[2]
n=length(dat$PX_LAST)
#date<-XOM_raw$Dates[1:n]
#Portfoilo<-XOM[1:n]*156+INTC[1:n]*200
#Portfoilo1d<-XOM1d[1:n]*156+INTC1d[1:n]*200
#Portrtn<-Portfoilo/Portfoilo1d
PortWinGBM5r<-WinEstGBM(dat$PX_LAST,252*5)
PortWinGBM5r<-winEstGBM(dat$PX_LAST,252*5)
PortWinGBMdrift5y<-unlist(PortWinGBM5r[2])
PortWinGBMvol5y<-unlist(PortWinGBM5r[1])
s0      = 10000000
years   = 5
dt      = 5/252
VaRp    = 0.99
#ESp     = 0.975
npts = 252*years
npaths = 10000
ntrials = n-npts
scenarios<-matrix(rep(0,npaths*ntrials),nrow=npaths)
bgmsampset<-function(dt,k,mu,sigma){
return(exp(sqrt(dt) * rnorm(k,mean=0,sd=1)*sigma+ (mu - sigma^2/2)*dt))
}
for (i in 1:ntrials) {
scenarios[,i]=s0*bgmsampset(dt,npaths,PortWinGBMdrift5y[i],PortWinGBMvol5y[i])
}
portsort<-matrix(rep(0,npaths*ntrials),nrow=npaths)
for (i in 1:ntrials) {
portsort[,i]=sort(scenarios[,i],decreasing = F)
}
# sort
portsort<-matrix(rep(0,npaths*ntrials),nrow=npaths)
View(scenarios)
head(scenarios)
VaR_Monte <- function(mu,vol){
p0 <- 141.29
r <- 0.005
K <- 2085.18
T <- 5/252
w <- rnorm(10000)
w <- w*(sqrt(T))
St <- 2085.18*exp((mu-(vol^2)/2)*T+vol*w)
Vt <- Put(St,K,r,1,17.67/100)
loss <- 10000000*0.99/K*(K-St)+10000000*0.01/p0*(p0-max((K-St),0))
VaR <- precentile(loss,0.99)
return(VaR)
}
VaR_Monte <- function(mu,sigma){
p0 <- 141.29
r <- 0.005
K <- 2085.18
T <- 5/252
w <- rnorm(10000)
w <- w*(sqrt(T))
St <- 2085.18*exp((mu-(sigma^2)/2)*T+sigma*w)
Vt <- Put(St,K,r,1,17.67/100)
loss <- 10000000*0.99/K*(K-St)+10000000*0.01/p0*(p0-max((K-St),0))
VaR <- precentile(loss,0.99)
return(VaR)
}
VaR_Monte(mu=0.1133424,sigma=0.1345705)
VaR_Monte <- function(mu,sigma){
p0 <- 141.29
r <- 0.005
K <- 2085.18
T <- 5/252
w <- rnorm(10000)
w <- w*(sqrt(T))
St <- 2085.18*exp((mu-(sigma^2)/2)*T+sigma*w)
Vt <- Put(St,K,r,1,17.67/100)
loss <- 10000000*0.99/K*(K-St)+10000000*0.01/p0*(p0-max((K-St),0))
VaR <- percentile(loss,0.99)
return(VaR)
}
VaR_Monte(mu=0.1133424,sigma=0.1345705)
VaR_Monte <- function(mu,sigma){
p0 <- 141.29
r <- 0.005
K <- 2085.18
T <- 5/252
w <- rnorm(10000)
w <- w*(sqrt(T))
St <- 2085.18*exp((mu-(sigma^2)/2)*T+sigma*w)
Vt <- Put(St,K,r,1,17.67/100)
loss <- 10000000*0.99/K*(K-St)+10000000*0.01/p0*(p0-max((K-St),0))
VaR <- quantile(loss,0.99)
return(VaR)
}
VaR_Monte(mu=0.1133424,sigma=0.1345705)
VaR_Monte <- function(mu,sigma){
p0 <- 141.29
r <- 0.005
K <- 2085.18
T <- 5/252
w <- rnorm(10000)
w <- w*(sqrt(T))
St <- 2085.18*exp((mu-(sigma^2)/2)*T+sigma*w)
Vt <- Put(St,K,r,1,17.67/100)
loss <- 10000000*0.99/K*(K-St)+10000000*0.01/p0*(p0-max((K-St),0))
VaR <- quantile(loss,0.99)
return(VaR)
}
VaR_Monte(mu=0.1133424,sigma=0.1345705)
set.seed(123)
VaR_Monte <- function(mu,sigma){
p0 <- 141.29
r <- 0.005
K <- 2085.18
T <- 5/252
w <- rnorm(10000)
w <- w*(sqrt(T))
St <- 2085.18*exp((mu-(sigma^2)/2)*T+sigma*w)
Vt <- Put(St,K,r,1,17.67/100)
loss <- 10000000*0.99/K*(K-St)+10000000*0.01/p0*(p0-max((K-St),0))
VaR <- quantile(loss,0.99)
return(VaR)
}
VaR_Monte(mu=0.1133424,sigma=0.1345705)
test <- function(mu,sigma,liquid){
p0 <- 141.29
r <- 0.005
K <- 2085.18
T <- 5/252
w <- rnorm(10000)
w <- w*(sqrt(T))
St <- 2085.18*exp((mu-(sigma^2)/2)*T+sigma*w)
Vt <- Put(St,K,r,1,17.67/100)
loss <- 10000000*(1-liquid)/K*(K-St)+10000000*liquid/p0*(p0-max((K-St),0))
VaR <- quantile(loss,0.99)
return(VaR)
}
test1 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.01)
test2 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.05)
test3 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.08)
test1
test2
test3
test0 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.01)
test1 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.05)
test2 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.08)
(test1-test0)/test0
(test2-test0)/test0
(test0-test1)/test0
test <- function(mu,sigma,liquid){
set.seed(123)
p0 <- 141.29
r <- 0.005
K <- 2085.18
T <- 5/252
w <- rnorm(10000)
w <- w*(sqrt(T))
St <- 2085.18*exp((mu-(sigma^2)/2)*T+sigma*w)
Vt <- Put(St,K,r,1,17.67/100)
loss <- 10000000*(1-liquid)/K*(K-St)+10000000*liquid/p0*(p0-max((K-St),0))
VaR <- quantile(loss,0.99)
return(VaR)
}
test(mu=0.1133424,sigma=0.1345705,liquid=0.01)
test(mu=0.1133424,sigma=0.1345705,liquid=0.05)
test(mu=0.1133424,sigma=0.1345705,liquid=0.08)
test0 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.01)
test1 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.05)
test2 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.08)
test(mu=0.1133424,sigma=0.1345705,liquid=0.01)
test(mu=0.1133424,sigma=0.1345705,liquid=0.05)
test(mu=0.1133424,sigma=0.1345705,liquid=0.08)
(test0-test1)/test0
(test0-test2)/test0
test3 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.10)
test4 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.15)
(test0-test1)/test0
(test0-test2)/test0
(test0-test3)/test0
(test0-test4)/test0
(test0-test5)/test0
test5 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.20)
(test0-test1)/test0
(test0-test2)/test0
(test0-test3)/test0
(test0-test4)/test0
(test0-test5)/test0
test6 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.175)
(test0-test1)/test0
(test0-test2)/test0
(test0-test3)/test0
(test0-test4)/test0
(test0-test5)/test0
(test0-test6)/test0
test7 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.13)
(test0-test7)/test0
(test0-test1)/test0
(test0-test2)/test0
(test0-test3)/test0
(test0-test4)/test0
(test0-test5)/test0
(test0-test6)/test0
(test0-test7)/test0
test6 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.17)
(test0-test6)/test0
test6 <- test(mu=0.1133424,sigma=0.1345705,liquid=0.172)
(test0-test6)/test0
